var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),tui;!function(tui){!function(widget){!function(ext){"use strict";function translateValue(value,item,index){if(value instanceof Array){for(var s="",_i=0,value_2=value;_i<value_2.length;_i++){var item_1=value_2[_i];item_1&&item_1.name&&(s.length>0&&(s+=", "),s+=item_1.name)}return document.createTextNode(s)}return value&&value.name?value.name:null}var FormDialogSelect=function(_super){function FormDialogSelect(form,define){var _this=_super.call(this,form,define,"dialog-select")||this;return _this.init(),_this._widget.set("iconRight",_this._rightIcon),_this._searchBox=widget.create("input"),_this._searchBox._set("iconLeft","fa-search"),_this._searchBox._set("clearable",!0),_this._searchBox._set("placeholder",tui.str("label.search")),_this._list=widget.create("list"),_this._list._set("rowTooltipKey",_this._rowTooltip),_this._list._set("nameKey","displayName"),_this._dialogDiv=tui.elem("div"),_this._dialogDiv.className="tui-dialog-select-div",_this._dialogDiv.appendChild(_this._searchBox._),_this._dialogDiv.appendChild(_this._list._),_this._widget._set("mobileModel",!0),_this._widget._set("title",_this._title),_this._widget._set("content",_this._dialogDiv),_this._searchBox.on("enter clear",function(){_this._searchBox.get("value")?_this.queryList():_this.queryTree()}),_this._widget.on("open",function(){_this._searchBox.set("value",""),_this.queryTree()}),_this._widget.on("clear",function(){_this.define.multiple?_this.define.value=[]:_this.define.value=null,form.fire("itemvaluechanged",{control:_this})}),_this._widget.on("select",function(e){if(_this.define.multiple){for(var values=_this.define.value,checkedItems=_this._list.get("checkedItems"),i=0;i<checkedItems.length;i++){for(var k=checkedItems[i][_this._key],exists=!1,_i=0,values_1=values;_i<values_1.length;_i++)if(values_1[_i][_this._key]==k){exists=!0;break}exists||((obj={})[_this._key]=k,obj.name=checkedItems[i].name,values.push(obj))}for(var text="",i=0;i<values.length;i++)i>0&&(text+=", "),text+=values[i].name;_this.define.value=values,_this._widget.set("text",text),form.fire("itemvaluechanged",{control:_this})}else{var row=_this._list.get("activeRowData");if(null==row)return tui.msgbox(_this._invalidSelectionMessage),!1;if(!_this._rowType.test(row.type))return tui.msgbox(_this._invalidSelectionMessage),!1;var obj={};obj[_this._key]=row[_this._key],obj.name=row.name,_this.define.value=obj,_this._widget.set("text",row.name),form.fire("itemvaluechanged",{control:_this})}}),_this}return __extends(FormDialogSelect,_super),FormDialogSelect.prototype.queryTree=function(){var _this=this,datasource=new tui.ds.RemoteTree;datasource.on("query",function(e){var parentId=null===e.data.parent?null:e.data.parent.item.id,topmost=!1;null===parentId&&_this.define.organ&&"number"==typeof _this.define.organ.id&&(parentId=_this.define.organ.id,topmost=!0),tui.ajax.post_(_this._classType.listApi,{organId:parentId,withSubCompany:!!_this.define.withSubCompany,topmost:topmost}).done(function(result){datasource.update({parent:e.data.parent,data:result})}).fail(function(status,message){datasource.update({parent:e.data.parent,data:[]}),tui.errbox(message)})}),this._list.set("activeRow",null),this._list.set("tree",datasource)},FormDialogSelect.prototype.queryList=function(){var _this=this,query={keyword:this._searchBox.get("value"),organId:this.define.organ&&"number"==typeof this.define.organ.id?this.define.organ.id:null,withSubCompany:!!this.define.withSubCompany};tui.ajax.post(this._classType.queryApi,query).done(function(result){_this._list.set("activeRow",null),_this._list.set("list",result)}).fail(function(){_this._list.set("list",[])})},FormDialogSelect.prototype.update=function(){_super.prototype.update.call(this),this._list._set("checkable",!!this.define.multiple),this._widget._set("clearable",!0),this.setValueInternal(this.define.value),this.define.required?this._widget._set("validate",[{format:"*any",message:tui.str("message.cannot.be.empty")}]):this._widget._set("validate",[])},FormDialogSelect.prototype.getValue=function(cal){return void 0===cal&&(cal=null),typeof this.define.value===tui.UNDEFINED?this.define.multiple?[]:null:this.define.value},FormDialogSelect.prototype.setValueInternal=function(value){if(this.define.multiple)if(value instanceof Array){for(var items=[],text="",_i=0,value_1=value;_i<value_1.length;_i++){var item=value_1[_i];item&&item[this._key]&&item.name&&((obj={})[this._key]=item[this._key],obj.name=item.name,items.push(obj),items.length>1&&(text+=", "),text+=item.name)}this.define.value=items,this._widget.set("text",text)}else this.define.value=[],this._widget.set("text","");else if(value&&value[this._key]&&value.name){var obj={};obj[this._key]=value[this._key],obj.name=value.name,this.define.value=obj,this._widget.set("text",value.name)}else this.define.value=null,this._widget.set("text","")},FormDialogSelect.prototype.setValue=function(value){this.setValueInternal(value),this.form.fire("itemvaluechanged",{control:this})},FormDialogSelect.prototype.getProperties=function(){var properties=[{type:"organ",key:"organ",label:tui.str("label.top.organ"),value:this.define.organ,withSubCompany:!0,size:2,newline:!0},{type:"options",key:"withSubCompany",label:tui.str("label.with.sub.company"),value:!!this.define.withSubCompany,options:[{data:[{value:!0,text:tui.str("yes")},{value:!1,text:tui.str("no")}]}],atMost:1,size:2,newline:!0}];return this._allowMultiSelect&&properties.push({type:"options",key:"multiple",label:tui.str("label.multiselect"),value:!!this.define.multiple,options:[{data:[{value:!0,text:tui.str("yes")},{value:!1,text:tui.str("no")}]}],atMost:1,size:2}),[{name:tui.str(this._classType.desc),properties:properties}]},FormDialogSelect.prototype.setProperties=function(properties){var values=properties[1];this.define.multiple!=!!values.multiple&&(this.define.multiple=!!values.multiple,this.setValue(null)),this.define.withSubCompany=!!values.withSubCompany,this.define.organ=values.organ},FormDialogSelect.prototype.validate=function(){return this._widget.validate()},FormDialogSelect}(widget.BasicFormControl),FormUserSelect=function(_super){function FormUserSelect(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(FormUserSelect,_super),FormUserSelect.prototype.init=function(){this._classType=FormUserSelect,this._rightIcon="fa-user-o",this._title=tui.str("label.select.user"),this._rowType=/^user$/,this._rowTooltip="tooltip",this._invalidSelectionMessage=tui.str("message.select.user"),this._key="account",this._allowMultiSelect=!0},FormUserSelect.icon="fa-user-o",FormUserSelect.desc="label.user",FormUserSelect.order=200,FormUserSelect.queryApi=null,FormUserSelect.listApi=null,FormUserSelect.init={multiple:!1,withSubCompany:!0},FormUserSelect.translator=translateValue,FormUserSelect}(FormDialogSelect);widget.Form.register("user",FormUserSelect);var FormOrganSelect=function(_super){function FormOrganSelect(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(FormOrganSelect,_super),FormOrganSelect.prototype.init=function(){this._classType=FormOrganSelect,this._rightIcon="fa-building-o",this._title=tui.str("label.select.organ"),this._rowType=/^(company|department)$/,this._rowTooltip="tooltip",this._invalidSelectionMessage=tui.str("message.select.organ"),this._key="id",this._allowMultiSelect=!1},FormOrganSelect.icon="fa-building-o",FormOrganSelect.desc="label.organization",FormOrganSelect.order=201,FormOrganSelect.queryApi=null,FormOrganSelect.listApi=null,FormOrganSelect.init={multiple:!1,withSubCompany:!0},FormOrganSelect.translator=translateValue,FormOrganSelect}(FormDialogSelect);widget.Form.register("organ",FormOrganSelect),tui.dict("en-us",{"label.user":"User","label.multiselect":"Multi-Select","label.search":"Search","label.select.user":"Select User","label.select.organ":"Select Organization","label.organization":"Organiztion","label.top.organ":"Top Organization","label.with.sub.company":"Include Sub Company","message.select.organ":"Please select an organization!","message.select.user":"Please select an user!"}),tui.dict("zh-cn",{"label.user":"用户","label.multiselect":"多选","label.search":"搜索","label.select.user":"选择用户","label.select.organ":"选择机构","label.organization":"组织机构","label.top.organ":"顶层机构","label.with.sub.company":"包括子公司","message.select.organ":"请选择一个机构！","message.select.user":"请选择一个用户！"}),ext.setUserSelectApiPath=function(queryApi,listApi){FormUserSelect.queryApi=queryApi,FormUserSelect.listApi=listApi},ext.setOrganSelectApiPath=function(queryApi,listApi){FormOrganSelect.queryApi=queryApi,FormOrganSelect.listApi=listApi}}(widget.ext||(widget.ext={}))}(tui.widget||(tui.widget={}))}(tui||(tui={}));