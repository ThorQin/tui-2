var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),tui;!function(tui){!function(widget){!function(ext){"use strict";function mergeArray(key,src,newValues){var result=[];if(!(newValues instanceof Array))return src;if(!(src instanceof Array)||0==src.length)return newValues;result.splice.apply(result,[0,0].concat(src));for(var i=0;i<newValues.length;i++){for(var k=newValues[i][key],exists=!1,_i=0,result_1=result;_i<result_1.length;_i++)if(result_1[_i][key]==k){exists=!0;break}if(!exists){var obj={};obj[key]=k,obj.name=newValues[i].name,result.push(obj)}}return result}function createSelector(key,title,rowTooltip,rowType,invalidMessage,classType,handler){function queryTree(){var datasource=new tui.ds.RemoteTree;datasource.on("query",function(e){var parentId=null===e.data.parent?null:e.data.parent.item.id,topmost=!1;null!==parentId||"number"!=typeof _topOrganId&&!_topOrganId||(parentId=_topOrganId,topmost=!0),tui.ajax.post_(classType.listApi,{organId:parentId,withSubCompany:!!_withSubCompany,topmost:topmost}).done(function(result){datasource.update({parent:e.data.parent,data:result})}).fail(function(status,message){datasource.update({parent:e.data.parent,data:[]}),tui.errbox(message)})}),list.set("activeRow",null),list.set("tree",datasource)}function queryList(){var query={keyword:searchBox.get("value"),organId:"number"==typeof _topOrganId||_topOrganId?_topOrganId:null,withSubCompany:!!_withSubCompany};tui.ajax.post(classType.queryApi,query).done(function(result){list.set("activeRow",null),list.set("list",result)}).fail(function(){list.set("list",[])})}var searchBox=widget.create("input");searchBox._set("iconRight","fa-search"),searchBox._set("clearable",!0),searchBox._set("type","search"),searchBox._set("placeholder",tui.str("label.search"));var list=widget.create("list");list._set("rowTooltipKey",rowTooltip),list._set("nameKey","displayName");var dialogDiv=tui.elem("form");dialogDiv.onsubmit=function(){return!1},dialogDiv.setAttribute("action","#"),dialogDiv.className="tui-dialog-select-div",dialogDiv.appendChild(searchBox._),dialogDiv.appendChild(list._);var dialog=widget.create("dialog");dialog._set("mobileModel",!0),dialog.setContent(dialogDiv),dialog.set("title",title);var _topOrganId,_withSubCompany,_multiple;return searchBox.on("enter clear right-icon-click",function(){searchBox.get("value")?queryList():queryTree()}),dialog.on("open",function(){searchBox.set("value",""),queryTree()}),dialog.on("btnclick",function(e){if("function"==typeof handler)if(_multiple){for(var values=[],checkedItems=list.get("checkedItems"),i=0;i<checkedItems.length;i++)(obj={})[key]=checkedItems[i][key],obj.name=checkedItems[i].name,values.push(obj);!1!==handler(values)&&dialog.close()}else{var row=list.get("activeRowData");if(null==row)return void tui.msgbox(invalidMessage);if(!rowType.test(row.type))return void tui.msgbox(invalidMessage);var obj={};obj[key]=row[key],obj.name=row.name,!1!==handler(obj)&&dialog.close()}}),function(topOrgan,withSubCompany,multiple){_topOrganId=topOrgan?topOrgan.id:null,_withSubCompany=withSubCompany,_multiple=!!multiple,list.set("checkable",!!multiple),dialog.open("ok#tui-primary")}}function translateValue(value,item,index){if(value instanceof Array){for(var s="",_i=0,value_2=value;_i<value_2.length;_i++){var item_1=value_2[_i];item_1&&item_1.name&&(s.length>0&&(s+=", "),s+=item_1.name)}return document.createTextNode(s)}return value&&value.name?value.name:null}var FormDialogSelect=function(_super){function FormDialogSelect(form,define){var _this=_super.call(this,form,define,"dialog-select")||this;_this.init(),_this._widget.set("iconRight",_this._rightIcon);var selector=createSelector(_this._key,_this._title,_this._rowTooltip,_this._rowType,_this._invalidSelectionMessage,_this._classType,function(result){if(_this.define.multiple){for(var values=mergeArray(_this._key,_this.define.value,result),text="",i=0;i<values.length;i++)i>0&&(text+=", "),text+=values[i].name;_this.define.value=values,_this._widget.set("text",text),form.fire("itemvaluechanged",{control:_this})}else _this.define.value=result,_this._widget.set("text",result.name),form.fire("itemvaluechanged",{control:_this})});return _this._widget.on("open",function(){return selector(_this.define.organ,_this.define.withSubCompany,_this.define.multiple),!1}),_this._widget.on("clear",function(){_this.define.multiple?_this.define.value=[]:_this.define.value=null,form.fire("itemvaluechanged",{control:_this})}),_this}return __extends(FormDialogSelect,_super),FormDialogSelect.prototype.update=function(){_super.prototype.update.call(this),this._widget._set("clearable",!0),this.setValueInternal(this.define.value),this.define.required?this._widget._set("validate",[{format:"*any",message:tui.str("message.cannot.be.empty")}]):this._widget._set("validate",[])},FormDialogSelect.prototype.getValue=function(cal){return void 0===cal&&(cal=null),typeof this.define.value===tui.UNDEFINED?this.define.multiple?[]:null:this.define.value},FormDialogSelect.prototype.setValueInternal=function(value){if(this.define.multiple)if(value instanceof Array){for(var items=[],text="",_i=0,value_1=value;_i<value_1.length;_i++){var item=value_1[_i];item&&item[this._key]&&item.name&&((obj={})[this._key]=item[this._key],obj.name=item.name,items.push(obj),items.length>1&&(text+=", "),text+=item.name)}this.define.value=items,this._widget.set("text",text)}else this.define.value=[],this._widget.set("text","");else if(value&&value[this._key]&&value.name){var obj={};obj[this._key]=value[this._key],obj.name=value.name,this.define.value=obj,this._widget.set("text",value.name)}else this.define.value=null,this._widget.set("text","")},FormDialogSelect.prototype.setValue=function(value){this.setValueInternal(value),this.form.fire("itemvaluechanged",{control:this})},FormDialogSelect.prototype.getProperties=function(){var properties=[{type:"organ",key:"organ",label:tui.str("label.top.organ"),value:this.define.organ,withSubCompany:!0,size:2,position:"newline"},{type:"options",key:"withSubCompany",label:tui.str("label.with.sub.company"),value:!!this.define.withSubCompany,options:[{data:[{value:!0,text:tui.str("yes")},{value:!1,text:tui.str("no")}]}],atMost:1,size:2,position:"newline"}];return this._allowMultiSelect&&properties.push({type:"options",key:"multiple",label:tui.str("label.multiselect"),value:!!this.define.multiple,options:[{data:[{value:!0,text:tui.str("yes")},{value:!1,text:tui.str("no")}]}],atMost:1,size:2}),[{name:tui.str(this._classType.desc),properties:properties}]},FormDialogSelect.prototype.setProperties=function(properties){var values=properties[1];this.define.multiple!=!!values.multiple&&(this.define.multiple=!!values.multiple,this.setValue(null)),this.define.withSubCompany=!!values.withSubCompany,this.define.organ=values.organ},FormDialogSelect.prototype.validate=function(){return this._widget.validate()},FormDialogSelect}(widget.BasicFormControl),FormUserSelect=function(_super){function FormUserSelect(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(FormUserSelect,_super),FormUserSelect.prototype.init=function(){this._classType=FormUserSelect,this._rightIcon="fa-user-o",this._title=tui.str("label.select.user"),this._rowType=/^user$/,this._rowTooltip="tooltip",this._invalidSelectionMessage=tui.str("message.select.user"),this._key="account",this._allowMultiSelect=!0},FormUserSelect.icon="fa-user-o",FormUserSelect.desc="label.user",FormUserSelect.order=200,FormUserSelect.queryApi=null,FormUserSelect.listApi=null,FormUserSelect.init={multiple:!1,withSubCompany:!0},FormUserSelect.translator=translateValue,FormUserSelect}(FormDialogSelect);widget.Form.register("user",FormUserSelect);var FormOrganSelect=function(_super){function FormOrganSelect(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(FormOrganSelect,_super),FormOrganSelect.prototype.init=function(){this._classType=FormOrganSelect,this._rightIcon="fa-building-o",this._title=tui.str("label.select.organ"),this._rowType=/^(company|department)$/,this._rowTooltip="tooltip",this._invalidSelectionMessage=tui.str("message.select.organ"),this._key="id",this._allowMultiSelect=!1},FormOrganSelect.icon="fa-building-o",FormOrganSelect.desc="label.organization",FormOrganSelect.order=202,FormOrganSelect.queryApi=null,FormOrganSelect.listApi=null,FormOrganSelect.init={multiple:!1,withSubCompany:!0},FormOrganSelect.translator=translateValue,FormOrganSelect}(FormDialogSelect);widget.Form.register("organ",FormOrganSelect);var FormUserList=function(_super){function FormUserList(form,define){var _this=_super.call(this,form,define,"list")||this,selector=createSelector("account",tui.str("label.select.user"),"tooltip",/^user$/,tui.str("message.select.user"),FormUserSelect,function(result){var values=mergeArray("account",_this.define.value,result);_this._notifyBar.innerHTML="",_this.setValue(values)});return _this._widget._.style.margin="2px",_this._buttonBar=tui.elem("div"),_this.div.appendChild(_this._buttonBar),_this._btnAdd=widget.create("button",{text:"<i class='fa fa-plus'></i>"}),_this._btnAdd.appendTo(_this._buttonBar),_this._btnAdd.on("click",function(){selector(_this.define.organ,_this.define.withSubCompany,!0)}),_this._btnDelete=widget.create("button",{text:"<i class='fa fa-minus'></i>"}),_this._btnDelete.appendTo(_this._buttonBar),_this._btnDelete.on("click",function(){var i=_this._widget.get("activeRow");null!==i&&(_this.define.value.splice(i,1),_this._notifyBar.innerHTML="",form.fire("itemvaluechanged",{control:_this}))}),_this._notifyBar=tui.elem("div"),_this._notifyBar.className="tui-form-notify-bar",_this.div.appendChild(_this._notifyBar),_this}return __extends(FormUserList,_super),FormUserList.prototype.update=function(){_super.prototype.update.call(this),this._notifyBar.innerHTML="";var d=this.define;d.value instanceof Array||(d.value=[]),this._widget._set("list",d.value),this.define.disable?(this._btnAdd.set("disable",!0),this._btnAdd._.style.display="none",this._btnDelete.set("disable",!0),this._btnDelete._.style.display="none",this._widget.set("disable",!0)):(this._btnAdd.set("disable",!1),this._btnAdd._.style.display="inline-block",this._btnDelete.set("disable",!1),this._btnDelete._.style.display="inline-block",this._widget.set("disable",!1)),this._widget.set("autoHeight",!1),"number"==typeof d.height&&!isNaN(d.height)||"string"==typeof d.height&&/^\d+$/.test(d.height)?this._widget._.style.height=d.height+"px":(this._widget._.style.height="",d.height=undefined)},FormUserList.prototype.getProperties=function(){return[{name:tui.str("label.user.list"),properties:[{type:"organ",key:"organ",label:tui.str("label.top.organ"),value:this.define.organ,withSubCompany:!0,size:2,position:"newline"},{type:"options",key:"withSubCompany",label:tui.str("label.with.sub.company"),value:!!this.define.withSubCompany,options:[{data:[{value:!0,text:tui.str("yes")},{value:!1,text:tui.str("no")}]}],atMost:1,size:2,position:"newline"},{type:"textbox",inputType:"number",key:"atLeast",label:tui.str("form.at.least"),value:/^\d+$/.test(this.define.atLeast+"")?this.define.atLeast:"",validation:[{format:"*digital",message:tui.str("message.invalid.value")}]},{type:"textbox",inputType:"number",key:"atMost",label:tui.str("form.at.most"),value:/^\d+$/.test(this.define.atMost+"")?this.define.atMost:"",validation:[{format:"*digital",message:tui.str("message.invalid.value")}]},{type:"textbox",inputType:"number",key:"height",label:tui.str("form.height"),value:/^\d+$/.test(this.define.height+"")?this.define.height:null,validation:[{format:"*digital",message:tui.str("message.invalid.value")}]}]}]},FormUserList.prototype.onPropertyPageSwitch=function(pages,recentPage){widget.FormControl.detectRequired(pages,recentPage)},FormUserList.prototype.setProperties=function(properties){var values=properties[1];this.define.height=/^\d+$/.test(values.height)?values.height:undefined,this.define.atLeast=values.atLeast?parseInt(values.atLeast):undefined,this.define.atMost=values.atMost?parseInt(values.atMost):undefined,this.define.withSubCompany=!!values.withSubCompany,this.define.organ=values.organ},FormUserList.prototype.getValue=function(){return this.define.value||[]},FormUserList.prototype.setValue=function(value){value!==this.define.value&&value instanceof Array&&(this.define.value=value,this._widget._set("list",this.define.value)),this._widget.render(),this.form.fire("itemvaluechanged",{control:this})},FormUserList.prototype.validate=function(){var d=this.define,data=this._widget.get("data");return d.atLeast&&data.length()<d.atLeast?(this._notifyBar.innerHTML=tui.browser.toSafeText(tui.strp("form.at.least.p",d.atLeast)),!1):!(d.atMost&&data.length()>d.atMost)||(this._notifyBar.innerHTML=tui.browser.toSafeText(tui.strp("form.at.most.p",d.atMost)),!1)},FormUserList.icon="fa-list",FormUserList.desc="label.user.list",FormUserList.order=201,FormUserList.init={withSubCompany:!0,position:"newline"},FormUserList}(widget.BasicFormControl);widget.Form.register("users",FormUserList);var QRCode=function(_super){function QRCode(form,define){var _this=_super.call(this,form,define,"dialog-select")||this;return _this._widget.set("iconRight","fa-barcode"),_this._widget.on("open",function(){return form.fire("itemevent",{event:"getQRCode",control:_this,url:_this.define.url,callback:function(value){"object"==typeof value&&null!=value&&_this.setValue(value)}}),!1}),_this._widget.on("clear",function(){_this.define.value=null,form.fire("itemvaluechanged",{control:_this})}),_this}return __extends(QRCode,_super),QRCode.prototype.setValueInternal=function(){var v=this.define.value;if(v){var text_1=typeof v.text!=tui.UNDEFINED&&null!=v.text?v.text:v.value;this._widget._set("value",v.value),this._widget.set("text",text_1)}else this._widget._set("value",null),this._widget.set("text","")},QRCode.prototype.update=function(){_super.prototype.update.call(this),this._widget._set("clearable",!0),this.setValueInternal(),this.define.required?this._widget._set("validate",[{format:"*any",message:tui.str("message.cannot.be.empty")}]):this._widget._set("validate",[])},QRCode.prototype.getValue=function(cal){return void 0===cal&&(cal=null),this.define.value},QRCode.prototype.setValue=function(value){"object"!=typeof value&&(value=null),this.define.value=value,this.setValueInternal(),this.form.fire("itemvaluechanged",{control:this})},QRCode.prototype.getProperties=function(){return[{name:tui.str("label.qrcode"),properties:[{type:"textbox",key:"url",label:tui.str("label.resolve.address"),size:2,value:this.define.url?this.define.url+"":null}]}]},QRCode.prototype.setProperties=function(properties){var values=properties[1];this.define.url=values.url?values.url+"":null},QRCode.prototype.validate=function(){return this._widget.validate()},QRCode.icon="fa-barcode",QRCode.desc="label.qrcode",QRCode.order=203,QRCode.init={},QRCode}(widget.BasicFormControl);widget.Form.register("qrcode",QRCode),tui.dict("en-us",{"label.resolve.address":"Resolve Address","label.qrcode":"QRCode","label.user":"User","label.user.list":"User List","label.multiselect":"Multi-Select","label.search":"Search","label.select.user":"Select User","label.select.organ":"Select Organization","label.organization":"Organiztion","label.top.organ":"Top Organization","label.with.sub.company":"Include Sub Company","message.select.organ":"Please select an organization!","message.select.user":"Please select an user!"}),tui.dict("zh-cn",{"label.resolve.address":"解析地址","label.qrcode":"二维码","label.user":"用户","label.user.list":"用户列表","label.multiselect":"多选","label.search":"搜索","label.select.user":"选择用户","label.select.organ":"选择机构","label.organization":"组织机构","label.top.organ":"顶层机构","label.with.sub.company":"包括子公司","message.select.organ":"请选择一个机构！","message.select.user":"请选择一个用户！"}),ext.setUserSelectApiPath=function(queryApi,listApi){FormUserSelect.queryApi=queryApi,FormUserSelect.listApi=listApi},ext.setOrganSelectApiPath=function(queryApi,listApi){FormOrganSelect.queryApi=queryApi,FormOrganSelect.listApi=listApi}}(widget.ext||(widget.ext={}))}(tui.widget||(tui.widget={}))}(tui||(tui={}));